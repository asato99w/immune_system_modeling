# T細胞の分化と機能：実装設計資料

## 1. 概要

CD4+ T細胞（ヘルパーT細胞）は、活性化後に環境中のサイトカインに応じて異なるサブセットに分化する。この分化により、病原体の種類に応じた適切な免疫応答が実現される。

## 2. T細胞活性化から分化までの流れ

```
1. 樹状細胞による抗原提示
   ↓
2. T細胞の活性化（TCR-MHC-ペプチド複合体認識）
   ↓
3. 環境サイトカインの感知
   ↓
4. 分化方向の決定
   ↓
5. エフェクター機能の発揮
```

## 3. Th1/Th2分化の詳細

### 3.1 Th1細胞（細胞性免疫）

#### 分化条件
- **必要なサイトカイン**: IL-12（樹状細胞から）、IFN-γ
- **マスター転写因子**: T-bet
- **分化のタイミング**: 活性化後24-72時間

#### 産生サイトカイン
- **IFN-γ**: 主要なエフェクターサイトカイン
- **IL-2**: T細胞の増殖促進
- **TNF-α**: 炎症促進

#### 標的細胞と効果
| 標的細胞 | 効果 |
|---------|------|
| マクロファージ | 殺菌能力の増強、活性酸素産生↑ |
| CD8+ T細胞 | 細胞傷害活性の増強 |
| B細胞 | IgG2a（マウス）へのクラススイッチ |

#### 対象病原体
- ウイルス（インフルエンザ、COVID-19等）
- 細胞内細菌（結核菌、リステリア等）
- 真菌（カンジダ等）
- がん細胞

### 3.2 Th2細胞（液性免疫）

#### 分化条件
- **必要なサイトカイン**: IL-4
- **マスター転写因子**: GATA3
- **分化のタイミング**: 活性化後24-72時間

#### 産生サイトカイン
- **IL-4**: B細胞活性化、IgEクラススイッチ
- **IL-5**: 好酸球の増殖・活性化
- **IL-13**: 粘液産生、組織修復

#### 標的細胞と効果
| 標的細胞 | 効果 |
|---------|------|
| B細胞 | 抗体産生促進、IgE/IgG1へのスイッチ |
| 好酸球 | 増殖・活性化、寄生虫攻撃 |
| 上皮細胞 | 粘液産生増加 |

#### 対象病原体
- 寄生虫（蠕虫等）
- 細胞外細菌の一部
- アレルゲン（副作用として）

## 4. Th1/Th2バランスと相互抑制

### 4.1 相互抑制メカニズム
```
Th1 → IFN-γ → Th2分化を抑制
Th2 → IL-4 → Th1分化を抑制
```

### 4.2 バランスの重要性
- **Th1優位**: 自己免疫疾患のリスク
- **Th2優位**: アレルギー疾患のリスク
- **適切なバランス**: 病原体に応じた適切な応答

## 5. 実装設計

### 5.1 最小限実装（Phase 1）

#### 実装する機能
1. T細胞活性化時の環境サイトカイン感知
2. IL-12優勢 → Th1分化
3. IL-4優勢 → Th2分化
4. 分化後のサイトカイン産生

#### クラス設計
```python
class TCell:
    def __init__(self, specificity):
        self._specificity = specificity
        self._activated = False
        self._differentiation = None  # "Th1", "Th2", or None
    
    def differentiate(self, cytokine_environment):
        """環境に応じて分化"""
        if IL-12が優勢:
            self._differentiation = "Th1"
        elif IL-4が優勢:
            self._differentiation = "Th2"
    
    def produce_cytokines(self):
        """分化に応じたサイトカイン産生"""
        if self._differentiation == "Th1":
            return {"IFN-gamma": amount}
        elif self._differentiation == "Th2":
            return {"IL-4": amount}
```

### 5.2 将来の拡張（Phase 2以降）

#### 追加可能な機能
1. **Th17/Treg分化**: より複雑な免疫制御
2. **クローン増殖**: T細胞数の動的変化
3. **メモリーT細胞**: 免疫記憶の実装
4. **他の免疫細胞との相互作用**: マクロファージ、B細胞等

#### 拡張時の考慮事項
- 分化の可塑性（初期は変更可能）
- 時間経過による安定化
- サイトカインの濃度依存性
- 複数サイトカインの競合

## 6. テスト設計

### 6.1 基本テスト
```python
# 分化テスト
- test_th1_differentiation_with_il12()
- test_th2_differentiation_with_il4()
- test_no_differentiation_without_cytokines()

# サイトカイン産生テスト
- test_th1_produces_ifn_gamma()
- test_th2_produces_il4()

# 相互作用テスト
- test_th1_th2_mutual_inhibition()
```

### 6.2 統合テスト
```python
# 樹状細胞との連携
- test_dc_il12_leads_to_th1()
- test_environmental_il4_leads_to_th2()

# 免疫応答の完成
- test_viral_infection_th1_response()
- test_parasitic_infection_th2_response()
```

## 7. 生物学的正確性のチェックポイント

### 実装時に確認すべき点
- [ ] 活性化が分化の前提条件
- [ ] 分化は不可逆的（簡略化として）
- [ ] サイトカイン産生は分化後のみ
- [ ] 環境サイトカインの濃度依存性
- [ ] Th1/Th2の相互排他性

## 8. 参考文献との対応

### 「The Beautiful Cure」での記述
- **第2章**: 樹状細胞によるT細胞活性化
- **第3章**: 免疫制御とバランス
- **第4章**: サイトカインと治療薬開発

### 実装の優先順位
1. 基本的な活性化（第2章）✅ 実装済み
2. Th1/Th2分化（第3-4章の基礎）← 現在
3. 制御性T細胞（第3章）← 将来
4. メモリーT細胞（後半章）← 将来

## 9. 次のステップ

### Phase 1（現在）
1. ✅ T細胞の基本実装
2. ✅ MHC-ペプチド複合体認識
3. → Th1/Th2分化機能の追加
4. → サイトカイン産生の実装

### Phase 2（将来）
1. マクロファージの実装
2. B細胞の実装
3. 細胞間相互作用の強化
4. 免疫応答のシミュレーション

---

*最終更新: 2024*
*作成者: Claude with Human Collaboration*